{"head":{"layout":"Post","comments":true,"date":"2017-03-08","title":"Formatez votre JavaScript avec prettier","tags":["javascript","tools","prettier"],"authors":["zoontek"],"description":"Rob Pike et Ken Thompson ont conçu le langage de programmation Go de façon à ce que celui-ci soit à portée des jeunes développeurs : si…"},"body":"<p>Rob Pike et Ken Thompson ont conçu le langage de programmation Go de façon à ce que celui-ci soit à portée des jeunes développeurs : si vous découvrez et commencez à apprendre le Go le lundi, vous devriez être en mesure d'être productif le mercredi. Le langage est extrêmement minimaliste, il y a rarement plus d'une façon de faire quelque chose.</p>\n<p>Seulement voilà, le développeur torturé se posera toujours un tas de questions essentielles : tabs ou spaces ? 2, 4 ou 8 spaces ? Single quotes ou double quotes ? Après quelles structures de contrôle passer une ligne ? Mais aussi les éternels : vim ou emacs ? Flow ou TypeScript ? Maintenir ce projet Angular 1 ou démissionner comme un prince ?</p>\n<p><em>N.B. : Pour information, les bonnes réponses sont bien évidemment spaces, 2, single quotes, vim, flow, la démission</em></p>\n<p>C'est pour répondre à ce problème (enfin, ceux liés au formatage de votre code) que Go intègre un formatting tool (<code>fmt</code>, comme la commande Unix), intitulé <a href=\"https://golang.org/cmd/gofmt/\">gofmt</a>. </p>\n<ol>\n<li>Vous codez comme vous le sentez  </li>\n<li>Vous sauvegardez votre fichier  </li>\n<li>Votre code est automatiquement formaté  </li>\n<li>Vous vous sentez frustré  </li>\n<li>Très vite, vous vous rendez compte que c'est pour votre bien, et que perdre du temps ou débattre sur ce genre de détails, c'est tout sauf utile</li>\n</ol>\n<p>Autre avantage non négligeable : le code Go que vous trouverez dans d'autres packages, des exemples, etc. sera toujours formaté de la même façon.</p>\n<p><em>À noter : Reason offre quelque chose de similaire avec <a href=\"https://facebook.github.io/reason/tools.html\">refmt</a>.</em></p>\n<p>Cette solution officielle n'existe pas en JS. Mais c'est ici qu'intervient <a href=\"https://github.com/prettier/prettier\">prettier</a> (et non <a href=\"https://www.npmjs.com/package/jsfmt\">jsfmt</a>, qui existe mais ne semble plus maintenu), un projet relativement récent, en version <code>0.21</code> à l'heure où j'écris ces lignes. Compatible <em>out of the box</em> avec le JS ES2017, JSX, flow, il offre également le moins de configuration possible (ce qui est une bonne chose). Le projet est activement suivi par Facebook, qui discute même la possibilité de s'en servir sur la codebase de <a href=\"https://github.com/facebook/react/pull/9101\">React</a>.</p>\n<h2 id=\"comment-ça-fonctionne-\"><a href=\"#comment-%C3%A7a-fonctionne-\" class=\"phenomic-HeadingAnchor\">#</a>Comment ça fonctionne ?</h2>\n<p>Croyez-le ou non, ce n'est pas \"tellement\" complexe. À la manière de babel ou flow, prettier utilise un AST parser (Abstract Syntax Tree parser) afin d'analyser le contenu de votre fichier JS, suite à quoi il va simplement formater votre code sans tenir compte de la forme précédente, en ne gardant que ce qui est important: le fond, pas la forme.</p>\n<p>Je vous invite à jouer avec <a href=\"https://astexplorer.net/\">AST explorer</a> pour comprendre beaucoup plus simplement comment tout cela fonctionne.</p>\n<h2 id=\"installation\"><a href=\"#installation\" class=\"phenomic-HeadingAnchor\">#</a>Installation</h2>\n<pre><code class=\"hljs language-console\">npm install --<span class=\"hljs-built_in\">save</span>-<span class=\"hljs-built_in\">dev</span> prettier</code></pre>\n<p>Ou, pour les meilleurs d'entre vous :</p>\n<pre><code class=\"hljs language-console\">yarn <span class=\"hljs-keyword\">add</span><span class=\"bash\"> --dev prettier</span></code></pre>\n<p>¯\\<em>(ツ)</em>/¯</p>\n<h2 id=\"configuration\"><a href=\"#configuration\" class=\"phenomic-HeadingAnchor\">#</a>Configuration</h2>\n<p>Car oui, il y en a tout de même un peu. Il est possible de régler:</p>\n<ul>\n<li>La longueur maximale des lignes (<code>printWidth</code>, <code>80</code> caractères par défaut)</li>\n<li>Le nombre d'espaces pour l'indentation (<code>tabWidth</code>, <code>2</code> par défaut, pas de tabs)</li>\n<li>Single quotes / double quotes (<code>singleQuote</code>, <code>false</code> par défaut)</li>\n<li>S'il faut ajouter des virgules en fin de certaines structures (comme les objets, mais aussi dans les paramètres de fonction, ce qui est possible depuis peu) (<code>trailingComma</code>, <code>none</code> par défaut, <code>es5</code> et <code>all</code> sont également possibles)</li>\n<li>S'il faut ajouter des espaces dans un objet écrit sur une seule ligne (<code>bracketSpacing</code>, <code>true</code> par défaut)</li>\n<li>Comment fermer les balises JSX (<code>jsxBracketSameLine</code>, <code>false</code> par défaut)</li>\n<li>Quel parser utiliser (<code>parser</code>, <code>babylon</code> par défaut, <code>flow</code> est disponible)</li>\n</ul>\n<blockquote>\n<p>Mais attends… Si l'on peut malgré tout configurer tout ça, ce n'est plus vraiment un style standard ?</p>\n</blockquote>\n<p>Oui et non, car il y aura toujours beaucoup de détails sur lesquels il nous sera impossible de choisir, les options resteront minimalistes. Par exemple, vous ne pourrez jamais retirer les points-virgules.</p>\n<p><code>EDIT: Il semblerait que malgré ce qui a pu être annoncé par l'auteur de prettier, une option --no-semicolons soit dans les tuyaux.</code></p>\n<p>Dans tous les cas, prettier reste un outil extrêmement pratique pour forcer le formatage du code au sein de votre équipe.</p>\n<p>Ouvrez votre <code>package.json</code>, c'est parti.</p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"prettify\"</span>: <span class=\"hljs-string\">\"prettier src/**/*.js\"</span>\n  },\n  <span class=\"hljs-attr\">\"devDependencies\"</span>: {\n    <span class=\"hljs-attr\">\"prettier\"</span>: <span class=\"hljs-string\">\"^0.21.0\"</span>\n  }\n}</code></pre>\n<p><code>npm run prettify</code> ou <code>yarn run prettify</code> formateront automatiquement tous les fichiers <code>.js</code> contenus dans votre dossier <code>/src</code>.\nBon j'avoue, c'est assez basique comme usage. Ajoutons-y notre config préférée.</p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"prettify\"</span>: <span class=\"hljs-string\">\"prettier --single-quote --trailing-comma all --write '{src,__{tests,mocks}__}/**/*.js'\"</span>\n  },\n  <span class=\"hljs-attr\">\"devDependencies\"</span>: {\n    <span class=\"hljs-attr\">\"prettier\"</span>: <span class=\"hljs-string\">\"^0.21.0\"</span>\n  }\n}</code></pre>\n<p><code>npm run prettify</code> ou <code>yarn run prettify</code> formateront maintenant automatiquement tous les fichiers <code>.js</code> contenus dans vos dossiers <code>/src</code>, <code>__tests__</code> et <code>__mocks__</code>, en utilisant le parser de flow, préférant les single quotes et en ajoutant une virgule en fin de chaque structure possible.</p>\n<p>OK. Mais si un membre de l'équipe oublie d'exécuter le script avant de commiter son code ?\n<strong>We got this !</strong> (avec 2 dépendances de plus).</p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"precommit\"</span>: <span class=\"hljs-string\">\"lint-staged\"</span>,\n    <span class=\"hljs-attr\">\"prettify\"</span>: <span class=\"hljs-string\">\"prettier --single-quote --trailing-comma all --write '{src,__{tests,mocks}__}/**/*.js'\"</span>\n  },\n  <span class=\"hljs-attr\">\"lint-staged\"</span>: {\n    <span class=\"hljs-attr\">\"{src,__{tests,mocks}__}/**/*.js\"</span>: [\n      <span class=\"hljs-string\">\"prettier --single-quote --trailing-comma all --write\"</span>,\n      <span class=\"hljs-string\">\"git add\"</span>\n    ]\n  },\n  <span class=\"hljs-attr\">\"devDependencies\"</span>: {\n    <span class=\"hljs-attr\">\"husky\"</span>: <span class=\"hljs-string\">\"^0.13.2\"</span>,\n    <span class=\"hljs-attr\">\"lint-staged\"</span>: <span class=\"hljs-string\">\"^3.3.1\"</span>,\n    <span class=\"hljs-attr\">\"prettier\"</span>: <span class=\"hljs-string\">\"^0.21.0\"</span>\n  }\n}</code></pre>\n<h2 id=\"les-plugins\"><a href=\"#les-plugins\" class=\"phenomic-HeadingAnchor\">#</a>Les plugins</h2>\n<p>Si vous ne pouvez pas attendre le moment du commit pour admirer votre code fraichement formaté, il existe déjà pas mal de plugins, pour pas mal d'éditeurs : <code>prettier-atom</code>, <code>prettier-vscode</code>, <code>Jsprettier</code> (pour Sublime Text), mais aussi pour emacs, vim, les IDE Jetbrain, etc. Tout est dans le <a href=\"https://github.com/prettier/prettier/blob/master/README.md\">README</a>.</p>\n<p><em>Protip: Inutile de vous conforter au style de formatage de votre équipe au sein de votre éditeur si le code est à nouveau formaté en pre-commit.</em></p>\n<h2 id=\"quelques-exemples-cest-possible-\"><a href=\"#quelques-exemples-cest-possible-\" class=\"phenomic-HeadingAnchor\">#</a>Quelques exemples, c'est possible ?</h2>\n<p>J'ai mieux. Il est possible d'<a href=\"https://prettier.github.io/prettier\">essayer en ligne</a> ! ✨</p>\n<h2 id=\"donc-cest-bon-tu-conseilles-\"><a href=\"#donc-cest-bon-tu-conseilles-\" class=\"phenomic-HeadingAnchor\">#</a>Donc c'est bon, tu conseilles ?</h2>\n<p>C'est tout de même à réfléchir. Le projet est encore jeune et en beta, même s'il évolue extrêmement vite. Tout n'est pas encore parfaitement supporté, mais je vous rassure, si vous n'utilisez pas le flow-parser vous ne risquez pas de rencontrer beaucoup de problèmes avec la dernière version.</p>\n<p>Des projets tels que <a href=\"https://github.com/facebook/immutable-js/commit/9bcc8b54a17c3bbc94d70864121784bc91011e8f\">immutable-js</a>, <a href=\"https://github.com/necolas/react-native-web/commit/a2f25a46c495ca53a75e728cfb14dbdf67cdb342\">react-native-web</a> et <a href=\"https://github.com/babel/babel/commit/bdbe2cfbc5ab5ba6f528b7ee3e4bf5ed940a47af\">babel</a> y sont déjà passés. Pourquoi pas vous ? 😉</p>\n","rawBody":"\nRob Pike et Ken Thompson ont conçu le langage de programmation Go de façon à ce que celui-ci soit à portée des jeunes développeurs : si vous découvrez et commencez à apprendre le Go le lundi, vous devriez être en mesure d'être productif le mercredi. Le langage est extrêmement minimaliste, il y a rarement plus d'une façon de faire quelque chose.\n\nSeulement voilà, le développeur torturé se posera toujours un tas de questions essentielles : tabs ou spaces ? 2, 4 ou 8 spaces ? Single quotes ou double quotes ? Après quelles structures de contrôle passer une ligne ? Mais aussi les éternels : vim ou emacs ? Flow ou TypeScript ? Maintenir ce projet Angular 1 ou démissionner comme un prince ?\n\n*N.B. : Pour information, les bonnes réponses sont bien évidemment spaces, 2, single quotes, vim, flow, la démission*\n\nC'est pour répondre à ce problème (enfin, ceux liés au formatage de votre code) que Go intègre un formatting tool (`fmt`, comme la commande Unix), intitulé [gofmt](https://golang.org/cmd/gofmt/). \n\n1) Vous codez comme vous le sentez  \n2) Vous sauvegardez votre fichier  \n3) Votre code est automatiquement formaté  \n4) Vous vous sentez frustré  \n5) Très vite, vous vous rendez compte que c'est pour votre bien, et que perdre du temps ou débattre sur ce genre de détails, c'est tout sauf utile\n\nAutre avantage non négligeable : le code Go que vous trouverez dans d'autres packages, des exemples, etc. sera toujours formaté de la même façon.\n\n*À noter : Reason offre quelque chose de similaire avec [refmt](https://facebook.github.io/reason/tools.html).*\n\nCette solution officielle n'existe pas en JS. Mais c'est ici qu'intervient [prettier](https://github.com/prettier/prettier) (et non [jsfmt](https://www.npmjs.com/package/jsfmt), qui existe mais ne semble plus maintenu), un projet relativement récent, en version `0.21` à l'heure où j'écris ces lignes. Compatible *out of the box* avec le JS ES2017, JSX, flow, il offre également le moins de configuration possible (ce qui est une bonne chose). Le projet est activement suivi par Facebook, qui discute même la possibilité de s'en servir sur la codebase de [React](https://github.com/facebook/react/pull/9101).\n\n## Comment ça fonctionne ?\n\nCroyez-le ou non, ce n'est pas \"tellement\" complexe. À la manière de babel ou flow, prettier utilise un AST parser (Abstract Syntax Tree parser) afin d'analyser le contenu de votre fichier JS, suite à quoi il va simplement formater votre code sans tenir compte de la forme précédente, en ne gardant que ce qui est important: le fond, pas la forme.\n\nJe vous invite à jouer avec [AST explorer](https://astexplorer.net/) pour comprendre beaucoup plus simplement comment tout cela fonctionne.\n\n## Installation\n\n```console\nnpm install --save-dev prettier\n```\n\nOu, pour les meilleurs d'entre vous :\n\n```console\nyarn add --dev prettier\n```\n\n¯\\\\_(ツ)_/¯\n\n## Configuration\n\nCar oui, il y en a tout de même un peu. Il est possible de régler:\n\n- La longueur maximale des lignes (`printWidth`, `80` caractères par défaut)\n- Le nombre d'espaces pour l'indentation (`tabWidth`, `2` par défaut, pas de tabs)\n- Single quotes / double quotes (`singleQuote`, `false` par défaut)\n- S'il faut ajouter des virgules en fin de certaines structures (comme les objets, mais aussi dans les paramètres de fonction, ce qui est possible depuis peu) (`trailingComma`, `none` par défaut, `es5` et `all` sont également possibles)\n- S'il faut ajouter des espaces dans un objet écrit sur une seule ligne (`bracketSpacing`, `true` par défaut)\n- Comment fermer les balises JSX (`jsxBracketSameLine`, `false` par défaut)\n- Quel parser utiliser (`parser`, `babylon` par défaut, `flow` est disponible)\n\n> Mais attends… Si l'on peut malgré tout configurer tout ça, ce n'est plus vraiment un style standard ?\n\nOui et non, car il y aura toujours beaucoup de détails sur lesquels il nous sera impossible de choisir, les options resteront minimalistes. Par exemple, vous ne pourrez jamais retirer les points-virgules.\n\n`EDIT: Il semblerait que malgré ce qui a pu être annoncé par l'auteur de prettier, une option --no-semicolons soit dans les tuyaux.`\n\nDans tous les cas, prettier reste un outil extrêmement pratique pour forcer le formatage du code au sein de votre équipe.\n\nOuvrez votre `package.json`, c'est parti.\n\n```json\n{\n  \"scripts\": {\n    \"prettify\": \"prettier src/**/*.js\"\n  },\n  \"devDependencies\": {\n    \"prettier\": \"^0.21.0\"\n  }\n}\n```\n\n`npm run prettify` ou `yarn run prettify` formateront automatiquement tous les fichiers `.js` contenus dans votre dossier `/src`.\nBon j'avoue, c'est assez basique comme usage. Ajoutons-y notre config préférée.\n\n```json\n{\n  \"scripts\": {\n    \"prettify\": \"prettier --single-quote --trailing-comma all --write '{src,__{tests,mocks}__}/**/*.js'\"\n  },\n  \"devDependencies\": {\n    \"prettier\": \"^0.21.0\"\n  }\n}\n```\n\n`npm run prettify` ou `yarn run prettify` formateront maintenant automatiquement tous les fichiers `.js` contenus dans vos dossiers `/src`, `__tests__` et `__mocks__`, en utilisant le parser de flow, préférant les single quotes et en ajoutant une virgule en fin de chaque structure possible.\n\nOK. Mais si un membre de l'équipe oublie d'exécuter le script avant de commiter son code ?\n**We got this !** (avec 2 dépendances de plus).\n\n```json\n{\n  \"scripts\": {\n    \"precommit\": \"lint-staged\",\n    \"prettify\": \"prettier --single-quote --trailing-comma all --write '{src,__{tests,mocks}__}/**/*.js'\"\n  },\n  \"lint-staged\": {\n    \"{src,__{tests,mocks}__}/**/*.js\": [\n      \"prettier --single-quote --trailing-comma all --write\",\n      \"git add\"\n    ]\n  },\n  \"devDependencies\": {\n    \"husky\": \"^0.13.2\",\n    \"lint-staged\": \"^3.3.1\",\n    \"prettier\": \"^0.21.0\"\n  }\n}\n```\n\n## Les plugins\n\nSi vous ne pouvez pas attendre le moment du commit pour admirer votre code fraichement formaté, il existe déjà pas mal de plugins, pour pas mal d'éditeurs : `prettier-atom`, `prettier-vscode`, `Jsprettier` (pour Sublime Text), mais aussi pour emacs, vim, les IDE Jetbrain, etc. Tout est dans le [README](https://github.com/prettier/prettier/blob/master/README.md).\n\n*Protip: Inutile de vous conforter au style de formatage de votre équipe au sein de votre éditeur si le code est à nouveau formaté en pre-commit.*\n\n## Quelques exemples, c'est possible ?\n\nJ'ai mieux. Il est possible d'[essayer en ligne](https://prettier.github.io/prettier) ! ✨\n\n## Donc c'est bon, tu conseilles ?\n\nC'est tout de même à réfléchir. Le projet est encore jeune et en beta, même s'il évolue extrêmement vite. Tout n'est pas encore parfaitement supporté, mais je vous rassure, si vous n'utilisez pas le flow-parser vous ne risquez pas de rencontrer beaucoup de problèmes avec la dernière version.\n\nDes projets tels que [immutable-js](https://github.com/facebook/immutable-js/commit/9bcc8b54a17c3bbc94d70864121784bc91011e8f), [react-native-web](https://github.com/necolas/react-native-web/commit/a2f25a46c495ca53a75e728cfb14dbdf67cdb342) et [babel](https://github.com/babel/babel/commit/bdbe2cfbc5ab5ba6f528b7ee3e4bf5ed940a47af) y sont déjà passés. Pourquoi pas vous ? 😉\n","__filename":"fr/articles/js/prettier/index.md","__url":"/fr/articles/js/prettier/","__resourceUrl":"/fr/articles/js/prettier/index.html","__dataUrl":"/fr/articles/js/prettier/index.html.a833d82de41444ec8575164f11b3a9a8.json"}